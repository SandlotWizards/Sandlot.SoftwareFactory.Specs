# 🧠 Command-Service Pipeline Design Spec

## ⚠ Canonical Enforcement Notice
This document defines a **canonical design specification** for the `Command-Service` AI Pipeline.  
Use of this document is **mandatory** for any implementation, execution, or interpretation of this pipeline.  
All sections must be completed clearly and consistently to enable AI-driven decomposition and reliable software generation.

---

## 📘 Purpose
This pipeline creates a pair of classes that follow the command-service design pattern, consisting of a Command and a CommandHandler.  
These components are the foundational building blocks for all pipelines and tools produced within the Software Factory.

---

## 🗂 Scope
This specification applies to all CLI-triggered or pipeline-generated command-service class pairs used in AI Pipelines, SoftwareFactory, and DeploymentFactory.

---

## 📥 Inputs
```yaml
- name: CommandName
  type: string
  required: true
  description: PascalCase name for the command (e.g., CreateUser)
- name: Description
  type: string
  required: false
  description: Optional human-readable summary of the command's intent
```

---

## 📤 Outputs
- `{CommandName}Command.cs`
- `{CommandName}CommandHandler.cs`
- Optional test suite (generated separately)
- CLI registration snippet
- **Each generated service includes structured logging via `ActionLog.Global.BeginStep(...)` per the logging standard**

---

## 🔁 Processing Flow
1. Parse inputs
2. Generate `Command` class from template
3. Generate `CommandHandler` using AI contract
4. Generate service class and SRP partials with scoped logging steps
5. Optionally inject CLI registration
6. Optionally trigger test suite generation

---

## 🔧 Decomposed Design
- Command class file → from static template
- Handler class file → from AI contract + handler template
- CLI registration snippet → inject into LoreCommandRegistration.cs
- Optional test suite → generated by TestSuiteGenerator pipeline

---

## 🚀 Design Action Plan
- `create-command-service --name {CommandName}`
- `generate-handler --from {CommandName} --ai`
- `inject-cli-registration --command {CommandName}`
- `gen-tests --sut {CommandName}CommandHandler`

---

## 🤖 AI Contracts Needed
- `HandlerPrompt` → generate handler logic
- `CommandSummaryPrompt` → generate XML docs and help text

---

## 🔗 Dependencies
- Requires `TemplateInjectionPipeline`
- Depends on `LoreCommandRegistration.cs`, `ILogger`, `ICommand`
- Assumes `ActionLog.Global` is initialized in the host environment

---

## ✅ Validation & Quality Checks
- Command and handler compile without errors
- No empty methods or TODOs
- New command is discoverable in CLI help output
- Orchestrator and partials include scoped logging via `BeginStep(...)`

---

## 🧪 Examples
TBD in later versions
